<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Authorization - FFI UAS</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="js/menu.js"></script>
    <script src="js/map-logic.js"></script> 
</head>
<body>

<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 30px; flex-wrap: wrap; gap: 20px;">
        <div>
            <h1>Flight Authorization Tool</h1>
            <span style="font-size: 0.95rem; color: #666;">Pre-flight Risk Assessment & Approval</span>
        </div>
        <div class="preset-container">
            <button class="preset-btn" onclick="loadScenario('jorgen')"><i class="fa-solid fa-triangle-exclamation" style="color:#dc3545"></i> Case 1: Hydrogen</button>
            <button class="preset-btn" onclick="loadScenario('attack_drone')"><i class="fa-solid fa-jet-fighter" style="color:#2c3e50"></i> Case 2: Attack</button>
            <button class="preset-btn" onclick="loadScenario('standard')"><i class="fa-solid fa-check" style="color:#28a745"></i> Standard Ops</button>
            <a href="pilot-overview.html" class="preset-btn" style="text-decoration:none; color:#333;"><i class="fa-solid fa-id-card"></i> Pilot Overview</a>
        </div>
    </div>

    <div class="section">
        <div class="section-header" style="border-left: 5px solid #17a2b8;">
            <i class="fa-solid fa-microchip" style="color: white;"></i> <h2 style="font-size:1.1rem; color:white;">1. UAS System Configuration</h2>
        </div>
        <div class="grid-row">
            <div class="form-group" id="grp_droneType">
                <label>Drone Type <i class="fa-solid fa-circle-info info-icon" onclick="showInfo('droneType')"></i> <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="droneType">
                    <option value="0">- Select Type -</option>
                    <option value="multirotor">Multirotor</option>
                    <option value="fixed_prop">Fixed wing (propeller)</option>
                    <option value="fixed_jet">Fixed wing (jet)</option>
                    <option value="helicopter">Helicopter</option>
                    <option value="vtol">VTOL</option>
                    <option value="lta">Lighter than air (Blimp/Balloon)</option>
                </select>
            </div>
            <div class="form-group" id="grp_weight">
                <label>Weight (MTOM) [BLF Ref] <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="weight">
                    <option value="0">- Select Weight -</option>
                    <option value="sub250">Class 0 (< 250 g) - EU 2019/945 C0, C1 or equiv.</option>
                    <option value="sub25">Class 1A (0 - 25 kg) - EU 2019/945 C0-C3 or equiv.</option>
                    <option value="sub150">Class 1B (25 - 150 kg) - MAA-NOR Form MUASTA reqs</option>
                    <option value="sub600">Class 2 (150 - 600 kg) - MAA-NOR Form MUASTA reqs</option>
                    <option value="over600">Class 3 (> 600 kg) - MAA-NOR Form MUASTA reqs</option>
                </select>
            </div>
        </div>
        <div class="grid-row">
            <div class="form-group" id="grp_classStatus">
                <label>System Class / Status <i class="fa-solid fa-circle-info info-icon" onclick="showInfo('class')"></i> <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="classStatus">
                    <option value="0">- Select Class -</option>
                    <option value="c_class">C-Class (C0-C6)</option>
                    <option value="mass_produced">Mass Produced / Standard</option>
                    <option value="experimental">Prototype / Experimental / Homebuilt</option>
                </select>
            </div>
            <div class="form-group" id="grp_energySource">
                <label>Energy Source <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="energySource">
                    <option value="0">- Select Energy -</option>
                    <option value="battery">Battery (LiPo/LiIon)</option>
                    <option value="fuel">Fossil Fuel</option>
                    <option value="hydrogen">Hydrogen / Fuel Cell</option>
                </select>
            </div>
        </div>
        <div class="grid-row">
            <div class="form-group">
                <label>Autopilot Mode</label>
                <select id="autopilot">
                    <option value="0">- Select Mode -</option>
                    <option value="stabilized">Stabilization Assist / GNSS</option>
                    <option value="manual">None / Full Manual (ATTI)</option>
                    <option value="automated">Fully Automated (Waypoints)</option>
                </select>
            </div>
            <div class="form-group" id="grp_dangerousGoods">
                <label>Payload / Dangerous Goods <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="dangerousGoods">
                    <option value="0">- Select Payload -</option>
                    <option value="no">None</option>
                    <option value="sensor">Passive Sensor / Camera</option>
                    <option value="yes">Live weapons or munitions</option>
                    <option value="pyro">Pyrotechnics</option>
                </select>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-header" style="border-left: 5px solid #ffc107;">
            <i class="fa-solid fa-location-dot" style="color: white;"></i> <h2 style="font-size:1.1rem; color:white;">2. Operational Profile</h2>
        </div>
        <div class="grid-row">
            <div class="form-group" id="grp_purpose">
                <label>Purpose <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="purpose">
                    <option value="0">- Select Purpose -</option>
                    <option value="testing">Testing / Research</option>
                    <option value="demo">Demonstration for audience</option>
                    <option value="exercise">Part of military exercise</option>
                    <option value="training">Pilot Training</option>
                </select>
            </div>
            <div class="form-group" id="grp_area">
                <label>Area of Operation <i class="fa-solid fa-circle-info info-icon" onclick="showInfo('area')"></i> <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="area">
                    <option value="0">- Select Area -</option>
                    <option value="sparsely">Sparsely populated area</option>
                    <option value="populated">Populated area</option>
                    <option value="controlled_ground">Controlled ground area (Inngjerdet/Sikret)</option>
                    <option value="firing_range">Controlled firing range (Skytefelt)</option>
                </select>
            </div>
        </div>
        <div class="grid-row">
            <div class="form-group">
                <label>Airspace</label>
                <select id="airspace">
                    <option value="uncontrolled">Uncontrolled airspace (G)</option>
                    <option value="controlled">Controlled airspace (CTR/TMA)</option>
                    <option value="danger_area">Active Danger/Restricted Area</option>
                </select>
            </div>
            <div class="form-group" id="grp_altitude">
                <label>Altitude <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="altitude">
                    <option value="below120">Below 120 m (400 ft)</option>
                    <option value="above120">Above 120 m</option>
                </select>
            </div>
        </div>
        <div class="grid-row">
            <div class="form-group" id="grp_riskAssessment">
                <label>Approved Risk Assessment (SORA/PDRA)?</label>
                <select id="riskAssessment">
                    <option value="0">- Select -</option>
                    <option value="no">No</option>
                    <option value="yes">Yes (Approved RA for this mission)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Other Airspace Users</label>
                <select id="otherUsers">
                    <option value="none">None / Segregated</option>
                    <option value="low">Low probability</option>
                    <option value="medium">Medium probability</option>
                    <option value="high">High probability</option>
                </select>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-header" style="border-left: 5px solid #28a745;">
            <i class="fa-solid fa-user-astronaut" style="color: white;"></i> <h2 style="font-size:1.1rem; color:white;">3. Pilot Competency</h2>
        </div>
        
        <div class="grid-row">
            <div class="form-group" id="grp_competence">
                <label>Competence Level <i class="fa-solid fa-circle-info info-icon" onclick="showInfo('competence')"></i></label>
                <select id="competence">
                    <option value="0">- Select Competence -</option>
                    <option value="none">None / Expired</option>
                    <option value="maak">MÅK (Militær Åpen Kategori)</option>
                    <option value="a1a3">Open A1 / A3</option>
                    <option value="a2">Open A2</option>
                    <option value="sts">STS / Specific</option>
                </select>
            </div>
            <div class="form-group" id="grp_recency">
                <label>Recency (Time since last flight) <i class="fa-solid fa-triangle-exclamation warning-icon-dynamic"></i></label>
                <select id="recency">
                    <option value="0">- Select Recency -</option>
                    <option value="recent">Less than 30 days</option>
                    <option value="medium">30 - 90 days</option>
                    <option value="expired">Over 90 days</option>
                </select>
            </div>
        </div>

        <div style="padding: 15px; background: #fff; border-bottom: 1px solid #eee;">
            <label style="margin-bottom: 10px;">Mandatory FFI Requirements</label>
            <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                <label class="checkbox-item" id="lbl_ffiCourse" style="border-color: #b8daff; background-color: #e8f4fd;">
                    <input type="checkbox" id="ffiCourse"> 
                    <strong>FFI UAS Introduction Ground Course (Completed)</strong>
                </label>
            </div>
        </div>

        <div style="display: flex; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px; border-right: 1px solid #eee;">
                <div class="grp-header"><i class="fa-solid fa-gamepad"></i> Drone System Ratings</div>
                <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                    <label class="checkbox-item" id="lbl_rate_multi"><input type="checkbox" id="rate_multi"> Multirotor</label>
                    <label class="checkbox-item" id="lbl_rate_fixed"><input type="checkbox" id="rate_fixed"> Fixed Wing</label>
                    <label class="checkbox-item" id="lbl_rate_heli"><input type="checkbox" id="rate_heli"> Helicopter</label>
                </div>
            </div>

            <div style="flex: 1; min-width: 300px; border-right: 1px solid #eee;">
                <div class="grp-header"><i class="fa-solid fa-weight-hanging"></i> Weight Ratings</div>
                <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                    <label class="checkbox-item"><input type="checkbox" checked disabled> Sub 250g (All)</label>
                    <label class="checkbox-item" id="lbl_rate_25"><input type="checkbox" id="rate_25"> < 25 kg (Class 1A)</label>
                    <label class="checkbox-item" id="lbl_rate_150"><input type="checkbox" id="rate_150"> < 150 kg (Class 1B)</label>
                    <label class="checkbox-item" id="lbl_rate_heavy"><input type="checkbox" id="rate_heavy"> > 150 kg (Class 2/3)</label>
                </div>
            </div>
            
            <div style="flex: 1; min-width: 300px;">
                <div class="grp-header"><i class="fa-solid fa-id-badge"></i> Operational Authorizations</div>
                <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                    <label class="checkbox-item"><input type="checkbox" id="rate_vlos" checked disabled> VLOS</label>
                    <label class="checkbox-item" id="lbl_rate_bvlos"><input type="checkbox" id="rate_bvlos"> BVLOS</label>
                    <label class="checkbox-item" id="lbl_rate_instructor"><input type="checkbox" id="rate_instructor"> Instructor</label>
                </div>
            </div>
        </div>
        
        <div style="padding: 15px; background: #fff; border-top: 1px solid #eee;">
            <label style="margin-bottom: 10px;"><i class="fa-solid fa-file-contract"></i> Qualified for Specific Risk Assessments</label>
            <div style="color:#666; font-size:0.85rem; margin-bottom:10px;">Check only if you have completed the read-in/training for the specific RA.</div>
            <div class="checkbox-grid">
                <label class="checkbox-item" id="lbl_qual_hydrogen"><input type="checkbox" id="qual_hydrogen"> RA-003 (Hydrogen)</label>
                <label class="checkbox-item" id="lbl_qual_demo"><input type="checkbox" id="qual_demo"> RA-005 (Display/Demo)</label>
                <label class="checkbox-item" id="lbl_qual_attack"><input type="checkbox" id="qual_attack"> RA-006 (Live Fire)</label>
            </div>
        </div>
    </div>

    <div id="result-box" class="res-gray">
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
            
            <span class="result-title" style="margin-top:15px;">AWAITING INPUT</span>
            <span class="result-desc">Please fill out all highlighted fields.</span>

            <div class="gauge-wrapper">
                <div class="gauge-body">
                    <div class="gauge-fill"></div>
                    <div class="gauge-cover"></div>
                    <div class="gauge-needle" id="gaugeNeedle"></div>
                </div>
                <div class="gauge-label" id="gaugeText">Risk Score: -</div>
            </div>
        </div>
        
        <div class="warning-list" id="warningList"></div>
    </div>

    <div id="submissionForm">
        <h3 style="color:#28a745; border-bottom:1px solid #e0e0e0; padding-bottom:10px; margin-top:0;">
            <i class="fa-solid fa-clipboard-list"></i> Flight Logging
        </h3>
        <p style="font-size:0.9rem; color:#555;">Standard operation. Submit to Ops Log.</p>
        
        <div class="grid-row" style="margin-top:15px;">
            <div class="form-group" style="border:none; padding:0;">
                <label>Pilot in Command</label>
                <input type="text" placeholder="Enter full name">
            </div>
            <div class="form-group" style="border:none; padding:0;">
                <label>Date & Time</label>
                <div style="display:flex; gap:10px;">
                    <input type="date" id="flightDate" onchange="calculateRisk()">
                    <input type="time">
                </div>
            </div>
        </div>
        <div class="grid-row">
            <div class="form-group" style="border:none; padding:0;">
                <label>Location (Coordinates/Name)</label>
                <input type="text" id="locationInput" placeholder="Click on map to set coordinates...">
            </div>
            <div class="form-group" style="border:none; padding:0;">
                <label>Flight Area Map (Click to mark)</label>
                <div id="map" class="map-container"></div>
                
                <div class="map-toolbar">
                    <button class="preset-btn" onclick="clearMap()"><i class="fa-solid fa-eraser"></i> Clear</button>
                </div>
            </div>
        </div>
        <button id="submitBtn" class="btn" style="width:100%; margin-top:15px; background-color:#28a745;" onclick="alert('Submitted successfully.')">Log Flight Details</button>
    </div>

</div>

<div id="infoModal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeInfo()">&times;</span>
    <h2 id="modalTitle" style="color:var(--ffi-blue); margin-bottom:10px;">Info</h2>
    <p id="modalText">Some text.</p>
  </div>
</div>

<script src="js/auth-logic.js"></script>
</body>
</html>